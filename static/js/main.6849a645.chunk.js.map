{"version":3,"sources":["img/camera.png","App.js","index.js"],"names":["module","exports","classifier","knnClassifier","App","props","_handleKeyDown","event","keyCode","toggleVideoCapture","toggleCameraMode","state","facingMode","setState","Webcam","maybeLoadWebcam","requestReset","Reset","Prediction","Confidence","ModelRunning","VideoCapture","webcamRef","React","createRef","this","tf","webcam","current","stop","document","addEventListener","InstallTrigger","alert","runModel","mobilenet","net","addExample","classId","a","capture","img","activation","infer","dispose","getElementById","clearAllClasses","getNumClasses","predictClass","result","classes","label","confidences","toFixed","className","id","onClick","ref","autoPlay","playsInline","muted","poster","videoLoadingImage","width","height","htmlFor","getConfidence","Component","ReactDOM","render"],"mappings":"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","file":"static/js/main.6849a645.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAMAAADDpiTIAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAARdQTFRF////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAdtbYJQAAAFx0Uk5TAAECAwYKDA0QFBUWGhscHyElKS8xNzw9PkFHSkxNTk9VWl9iZGdoaWxwcXR4e31+f4CGiouOlKSlqrC2uLq+v8DHysvM0dLV2Nni5ebn6Onq8PLz9ff4+fr7/f6pJy/dAAALS0lEQVR42u3dYWMTRQKA4dXQVtBaUcmB9kqkpQgVsZZaoNAWqBYsnDmQVmH+/++4D56A0CSbZGczmX3e7+6YzDNDsrvdFIUkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSQ1oPdJx5y5eu3lr9/HzkHjPHu1sbVxdmm0sgBBDwPyVu8dhqjraXp1vKIDKBcys7Ydp7NXDtZlGAqhWQGvlMExthyutJgKoUsDiQZjqDhabCKAyAQt7YerbW2gggIoEtLshg7rtBgKoRMDyccii4+UGAhhfQGszZNNmq3kAxhXQuhMy6k6reQDGFLAZsmqzgQDGErAcMmu5gQDGENA+zg3AcbuBAEYWsNAN2dVdaCCAUQXshQzbayKA0QQshixbbCKAUQS0DvIEcNBqIoARBKyETFtpJIChBcwc5grgcKaRAIYVsBayba2ZAIYU8DBfAPsNBTCUgPlX+QII8w0FMIyA1YznP1xpKoAhBGznDOBuYwGUFjB7lDOA47nGAigrYClk3cXmAigp4GreAK41GEA5ARt5A7jZZAClBGzlDeBWowGUEbCTN4DdZgMoIeBR3gAeNxzAYAHP8gbwvOkAwrj//bQHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABTAGDgAyKe5z3/zwa8/FODDvD88e6tm9cuJvq8wTO3x35EzOO8ATwa8PJPlzzO8d0rCT53uNMNYz8kajdvADsDXv5nQxxrf20mseUfQhj7MXG38gawNeDlfzHU0Q5XWkkt/wEASj0o8mbeADYGvPz2kMc7WExp+fcHUO5RsdfyBnB1wMv/eugj7i2ks/z7Aij5sOiLeQNYGvDyvxn+kN12Msu/H4Cyj4ufO855/o9mB7z870c46PFyKsu/D4DyPxhxN2cA24Ne/WiPSt5spbH8ewMY4idjruQMYHXQq98f7bh3Wkks/54AhvrRqIzn/9XAkzejPil3M4nl3wvAcD8bt58vgIeDXvsnIx96OYXl3wOAH478u4E/HHlh5EMftxNY/icD8NOxr0/cDTx1+93oB+8uTH75nwjAj0e/bvCPR98b4+h7k1/+JwHw8/FvTtsO/Kh+6vdxjr848eV/AoD1UQ6+mCeAwRPUjgws9vJ/H8D6aMffy3H+S2zRN2L/ExN5+b8HYMT5Lxa6+c1/mQ9pY94McTgz4eX/LoD1kcdoZ3dFoMzXtNN/xP6aGXn5vwNgfYxRlnMDUOZEzbfRTzRFXv7/BLA+1kCbec1/qVO1D+Kfao67/P8BYLz5L1p3cpr/UhdrPq/hYlPc5f82gPVxB2tltAeUu1z74/gDbU92+b8FYL2C8ZYz+SRY8oaND38df6iBN5zEXf5vAKxXMmQ7i2+DZW/Z6lQx2NJEl/9rAOsVDbqQwRmhsjdtfvBzFaNdnejy/xvAenUDL075dYHyt20vVTLexkSX//8BrFc5dGtliq8OD/OHGw8qGXFrosv/LwDrFQ8/s/bw1VRO/1B/uvVVNWPuTHT5hxCKyue/KIpifnX7aMo++Q/5x5sf3K9m3EcTXf4hhGI90qeQ2aWrG1s7j56lPvMj/vn2pYqGfzbR5R8a8PyDOH30W1UAJ7r8ARi1n0KSADrdAEAdffkyRQDDL38ARuvD+yFBAJ1uAKCefgjpARhp+QMwUhdepgeg0w0A1NTHT0JqAEZd/gCM8gHgXkgNQKcbAKitGyExAGMsfwCG79KrxAB0ugGA+vr3nyEpAOMtfwCG7V8vQlIAOt0AQI198d+QEoCxlz8AQ87/f0JKADrdAECt+3/163+MCahi+QMw1Oe/FyEhAJ1uAKDe739/hnQAVLT8ASh//u9GpPscJ7r8ASjbx/dCSAZAdcsfgJJdeBLSAdDpBgDq3f5/eBmSAVDp8gegTF/eDyEZAJ1uAKDWPvrpZUgGQNXLH4BBfXDptxCSAdDpBgBq7av7ISQDIMLyB6Dv6l96EEI6ADrdAECdH/07P4eQDoA4yx+AXn3+468hJASg0w0A1Nbpbx+E2pro8gfgvU61b+z+EUJSADrdAEAdfXLhu3u/h5qb6PIHoChOnf7si/bX33y/tT+ZRxlMdPnXASBorAlI5zwEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAEgAASAABAAAkAACAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAABIAAEgAAQAAJAAAgAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFCuo+3L58/OFhNu9uz5y9tH1U1ApwtAqZ6szhXJNLf6pLIJOHMbgMG9uD5TJNXM9ReVTUDUTSAPAE/PFcl17mllExBzE8gCwC+fFgn26S/VTUC8TSAHAE+TnP+i+PRpdRMQbRPIAMCLc0WinXtR4QRE2gQyAHC9SLbrVU5AnE1g+gE8mUkXwMyTSicgxiYw/QBWi4RbrXYCImwCUw/gaC5lAHNHFU9A5ZvA1APYLpJuu+oJqHoTmHoAl9MGcLn6Cah2E5h6AOfTBnA+wgRUuglMPYCzaQM4G2UCKtwEph7AbNoAZuNMQHWbAABTCaC6TcA/AdP4T0CFm4APgdP3IbDSTcDXwKn7GljtJuBE0JSdCKp6E3AqeLpOBVe+CbgYNE0XgyJsAtMPoEGXg2NsAtMPoDE3hMTZBDIA0JBbwiJtAhkAaMRNodE2gRwANOC28HibQBYAcv/DkJibQB4A8v7TsKibQCYAMv7j0MibQDYAcv3z8NibQPQ35FlQn55X/X4PuwlEB/DIJPfrceVv+JCbQHQAOya5X7sR3vKhNoHoALZMcr9uxXjPh9kEogPYMMn9uhnnXS+/CUQHcNUk9+tapLe99CYQHcCSSe7XxWhvfMlNIP734iOz3LvjiGevym0C8c+MbJvm3t2N+taX2QTiA1g1zb27Eve9L7EJxAcw/8o892w+9rs/cBOo4ez4Q/Pcq/347/6gTaAGAGsmuldrdVye6r8J1HFp/NBMn9xhPTcx9N0E6vgfWDHVJ7dS1zXqPptAHcO3Dsz1SR20artLofcmUMvwiyb7pBbrvFGl1yZQz+h7Zvv99uq9VanHJlDP4Atd8/1u3YW671Y7cROoaez2sRl/5ypAu/77FU/aBOoae9mU/7PlYhK9vwnUNvSmOX+7zWIyvbcJ1DZy645Zf9OdVjGp3tkE6hu4ZQ94s/4nN//vbgJ1jrzsk+Bfn/+Wi8n29iZQ68Bt3wZDCN12Mene2gTqHXjBGaGwt1Ak0OtNoO6BFxt+XeBgsUijvzeB2gdurTT46vDhSqtIpr82gQkMPLO238jZf/VwLa2HGJy5PRkARVHMX7nbsG8ER9ur80VydbphYmPPXbx289bu4+e5z/yzRztbG1eXEn2q/ZnbhSRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJDeh/qJJ+Pg5pMwYAAAAASUVORK5CYII=\"","import React, { Component } from 'react';\nimport * as mobilenet from '@tensorflow-models/mobilenet';\nimport * as tf from '@tensorflow/tfjs'\nimport * as knnClassifier from '@tensorflow-models/knn-classifier';\n\nimport videoLoadingImage from './img/camera.png'\n\n\nimport './App.css';\n\n\nconst classifier = knnClassifier.create();\n\nclass App extends Component {\n\n\n  constructor(props){\n    super(props);\n    this.state = {\n      Prediction: \"none\",\n      Confidence:  0,\n      ModelRunning: true,\n      VideoCapture: true,\n      Reset: false,\n      Webcam: null,\n      facingMode: 'environment'\n    }\n    this.webcamRef = React.createRef();\n  }\n\n\n  _handleKeyDown = (event) => {\n    var ESCAPE_KEY = 27;\n      switch( event.keyCode ) {\n          case ESCAPE_KEY:\n              this.toggleVideoCapture();\n              break;\n          default: \n              break;\n      }\n  }\n\n  toggleCameraMode = () => {\n    if(this.state.facingMode === 'environment'){\n      this.setState({facingMode: 'user'});\n    }\n    else{\n      this.setState({facingMode: 'environment'});\n    }\n    this.setState({Webcam: null});\n    this.maybeLoadWebcam();\n  }\n\n  async maybeLoadWebcam(){\n    if (this.state.Webcam === null){\n      // Create an object from Tensorflow.js data API which could capture image \n      // from the web camera as Tensor.\n      const webcam = await tf.data.webcam(this.webcamRef.current, {facingMode: this.state.facingMode});\n      this.setState({Webcam: webcam});\n      this.setState({Prediction: \"none\"})\n    }\n    return this.state.Webcam;\n  }\n\n  async toggleVideoCapture(){\n  if(this.state.VideoCapture && this.state.Webcam !== null){\n    this.state.Webcam.stop();\n    this.setState({VideoCapture: false});\n  }\n  else{\n    const webcam = await tf.data.webcam(this.webcamRef.current);\n    this.setState({Webcam: webcam});\n    this.setState({VideoCapture: true});\n  }\n}\n\n  componentDidMount(){\n    document.addEventListener(\"keydown\", this._handleKeyDown);\n\n    if(typeof InstallTrigger !== 'undefined'){\n      alert(\"This demo does not currently support firefox.\\r\\nWe recommended running it in Chrome instead.\");\n      this.setState({Prediction: \"This demo  does not currently support firefox.\"});\n    }\n    else{\n      this.runModel();\n    }\n  }\n\n  async runModel() {\n    const net = await mobilenet.load();\n    const webcam = await this.maybeLoadWebcam();  \n\n    // Reads an image from the webcam and associates it with a specific class\n    // index.\n    const addExample = async classId => {\n      if (this.state.VideoCapture){\n    // Capture an image from the web camera.\n    const img = await this.state.Webcam.capture();\n      \n    // Get the intermediate activation of MobileNet 'conv_preds' and pass that\n    // to the KNN classifier.\n    const activation = net.infer(img, 'conv_preds');\n\n    // Pass the intermediate activation to the classifier.\n    classifier.addExample(activation, classId);\n\n    // Dispose the tensor to release the memory.\n    img.dispose();\n      }\n    };\n  \n    // When clicking a button, add an example for that class.\n    document.getElementById('class-a').addEventListener('click', () => addExample(0));\n    document.getElementById('class-b').addEventListener('click', () => addExample(1));\n    document.getElementById('class-c').addEventListener('click', () => addExample(2));\n  \n    while (this.state.ModelRunning) {\n      if (this.state.Reset){\n        classifier.clearAllClasses();\n        this.setState({Confidence: 0, Prediction: \"none\", Reset: false});\n      }\n      if (classifier.getNumClasses() > 0 && this.state.VideoCapture) {\n        const img = await this.state.Webcam.capture();\n        \n        // Get the activation from mobilenet from the webcam.\n        const activation = net.infer(img, 'conv_preds');\n        // Get the most likely class and confidence from the classifier module.\n        const result = await classifier.predictClass(activation);\n  \n        const classes = ['A', 'B', 'C'];\n        //console.log(\"prediction: \" + classes[result.label] + \"\\n probability: \" + result.confidences[result.label]);\n        this.setState({Prediction: classes[result.label], Confidence: result.confidences[result.label]})\n        // Dispose the tensor to release the memory.\n        img.dispose();\n      }\n  \n      await tf.nextFrame();\n    }\n    this.setState({Prediction: \"Model suspended.\", Confidence: 0});\n  }\n\n  getConfidence(){\n    return \"Confidence: \" +  (this.state.ModelRunning ? \n            (this.state.Confidence * 100).toFixed(0) + \"%\" : \" --- \");\n  }\n\n  getPrediction(){\n    return this.state.ModelRunning ? \n    \"Prediction: \" + (this.state.Prediction) : \"Model suspended\";\n  }\n\n  requestReset = () => {\n    this.setState({Reset: true});\n  }\n\n  render() {\n    return(\n    <div className=\"App\">\n      \n      <header className=\"App-header\">\n      \n      <h1>ReClassify</h1>\n      <h4 className=\"h4\">On the fly image classification</h4>\n\n      </header>\n      <div className=\"App-main\">\n\n        <div><button id=\"toggleCameraMode\" onClick={this.toggleCameraMode}>&#8635;</button></div>\n      <video ref={this.webcamRef}\n        autoPlay\n        playsInline \n        muted \n        id=\"webcam\"\n        poster={videoLoadingImage}\n        width=\"224\" \n        height=\"224\">\n      </video>\n\n      <label className=\"label\" htmlFor=\"prediction\">{this.state.Prediction}<br></br>{this.getConfidence()}</label>\n      <div className=\"buttons\">\n      <button id=\"class-a\" >Class A</button>&nbsp;&nbsp;\n      <button id=\"class-b\">Class B</button>&nbsp;&nbsp;\n      <button id=\"class-c\">Class C</button></div>\n      <br></br>\n      <button id=\"reset\" onClick={this.requestReset}>Reset model</button>\n\n      </div>\n    </div>\n  );\n}\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render( < App / > , document.getElementById('root'));"],"sourceRoot":""}